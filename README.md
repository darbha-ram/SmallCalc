# SmallCalc

SmallCalc is a simple arithmetic expression evaluator written in Java. It is based on [JavaCC](https://javacc.java.net).

## Prerequisities

* JDK 1.8+
* Gradle v2.14+

JavaCC is also a prerequisite, but it doesn't have to be explicitly installed as Gradle handles that dependency.

## Installing

To get a development environment running:
- Install a recent version of the Java SDK
- Install [Gradle2.14+](https://gradle.org)
- Ensure gradleroot/bin is in your PATH.
- Clone the repo from [here](https://github.com/darbha-ram/SmallCalc.git).

## Assumptions

- Parsing errors result in "Error in expression" to be printed to console instead of an integer value. These can include unmatches braces or other errors that violate the grammar.  For example "let(a, let(b, 10, add(b, b)), let(b, 20, add(a, b))" is actually invalid as it is missing one closing brace.  Adding that brace, it evaluates to 40, as expected.
- If an expression parses correctly but violates some semantic rule e.g. division by zero, or literal is outside the Integer MIN - MAX range, evaluation fails and "Error in expression" is printed to console.
- Positive and negative integers are supported, e.g. "add (-3,1)" evaluates to -2.
- If a variable is missing e.g. "let(a, 10, add(c,10))" where "c" is unknown, then "Error in expression" is printed.
- For the purposes of this standalone application, log4j2 was used directly.  If implementing a shared library or more complex project, slf4j is a better choice as a facade that can be deployed with different logging implementations.


## Implementation 

The application source is contained in src/main/javacc/SmallCalc.jj.  The "jj" file is a JavaCC specification of the lexical and production rules of the grammar.  Each production is captured in a method that also has Java code to be executed when segments of that rule are matched.

For a description of "jj" file specification, see [JavaCC Documentation](http://javacc.java.net/doc/docindex.html).

Grammar rules specified in SmallCalc.jj:
```
Expr := AddExpr | MultExpr | SubExpr | DivExpr | UnaryExpr | LetExpr
AddExpr := "add" "(" Expr "," Expr ")"
MultExpr := "mult" "(" Expr "," Expr ")"
SubExpr := "sub" "(" Expr "," Expr ")"
DivExpr := "div" "(" Expr "," Expr ")"
LetExpr := "let" "(" AlphaLiteral "," Expr "," Expr ")"
UnaryExpr := IntegerLiteral | AlphaLiteral
```

Lexical tokens are defined as:

```
IntegerLiteral := ( ("-" DIGIT) | DIGIT ) [DIGIT]\*
AlphaLiteral := [a-zA-z]\*
```


## Build and Deploy

The command 'gradle build' executes the pre-compile step of running JavaCC on the grammar file, to generate Java source code for the parser. It then compiles that code and builds distributions.

```
$ cd SmallCalc (root folder of git repo)
$ gradle build
$ cd build/distributions
$ unzip SmallCalc.zip
$ cd SmallCalc/bin
```

## Execution Examples

Gradle generates scripts to execute the application, handling classpaths and other runtime details.  On Linux, use the executable script SmallCalc, on Windows use SmallCalc.bat.  SmallCalc uses log4j2 for logging. The file log4j.xml in build/ configures log4j. The output file is configured as build/smallcalc.log as default.

To get usage info:

```
$ ./SmallCalc
```

To evaluate expression and filter logs at the level set in log4j.xml:

```
$ ./SmallCalc "add(1, mult(3,4))"
```

To evaluate expression and filter logs at INFO level:

```
$ ./SmallCalc "add(1, mult(3,4))" INFO
```

## Running unit tests

JUnit tests are in src/test/java/SmallCalcTest.java.  They can be executed by:

```
$ gradle test
```

For each test, console output will indicate PASS, FAIL or SKIP.  A test report is generated by gradle at build/reports/tests/index.html.


## License

MIT License

